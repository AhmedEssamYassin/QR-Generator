@startuml
' --- Style Configuration ---
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 80
skinparam classAttributeIconSize 0
skinparam shadow true
skinparam packageStyle rectangle
skinparam roundcorner 15
skinparam handwritten false
skinparam defaultFontName "Segoe UI"

' --- Color Palette ---
!define UI_BG #EBF5FB
!define UI_BORDER #2E86C1
!define CORE_BG #E9F7EF
!define CORE_BORDER #27AE60
!define SERVICE_BG #FEF9E7
!define SERVICE_BORDER #F1C40F
!define MODEL_BG #F4ECF7
!define MODEL_BORDER #8E44AD

skinparam class {
    BackgroundColor White
    ArrowColor #2C3E50
    BorderColor #2C3E50
    HeaderBackgroundColor #ECF0F1
}

skinparam note {
    BackgroundColor #FDEDEC
    BorderColor #E74C3C
    FontColor #C0392B
}

' --- Package: Presentation Layer (UI) ---
package "src.ui" #EBF5FB {
    skinparam packageBorderColor<<UI>> #2E86C1
    
    class QRGeneratorView <<UI>> {
        <b>QRGeneratorView</b>
        --
        + __init__(controller, settingsService)
        + updatePreview(image)
        + getInputData(): dict
        + updateStatus(message)
    }

    class InputPanel <<UI>> {
        <b>InputPanel</b>
        --
        + getData(): dict
        + clear()
    }

    class SettingsPanel <<UI>> {
        <b>SettingsPanel</b>
        --
        + getSettings(): dict
        + updateColorButton(type, color)
    }

    class PreviewPanel <<UI>> {
        <b>PreviewPanel</b>
        --
        + updateImage(image)
        + showLoading()
    }
}

' --- Package: Business Logic Layer (Core) ---
package "src.core" #E9F7EF {
    class QRGeneratorController {
        <b>QRGeneratorController</b>
        --
        + __init__(model, settingsService)
        + generateQr()
        + saveQr()
        + copyToClipboard()
        - _validateInput(data): bool
    }

    class QRGeneratorModel {
        <b>QRGeneratorModel</b>
        --
        + currentConfig: QRConfig
        + qrImage: Image
        + setConfig(config)
    }

    class QRGenerator {
        <b>QRGenerator</b>
        --
        + {static} generate(config): Image
        - {static} _get_drawer(style)
    }
}

' --- Package: Services & Data ---
package "src.services" #FEF9E7 {
    class SettingsService {
        <b>SettingsService</b>
        --
        + get(key, default)
        + set(key, value)
    }

    class HistoryService {
        <b>HistoryService</b>
        --
        + add(config)
        + getRecent(limit)
    }
    
    class FileService {
        <b>FileService</b>
        --
        + {static} saveImage(image, path)
    }
}

package "src.core.models" #F4ECF7 {
    class QRConfig {
        <b>QRConfig</b>
        --
        + content: str
        + qrType: QRType
        + style: QRStyle
    }

    enum QRType {
        TEXT
        URL
        WIFI
        EMAIL
    }
}

' --- Relationships (Flow of Control) ---

' 1. UI Structure (Aggregation)
QRGeneratorView *-- InputPanel
QRGeneratorView *-- SettingsPanel
QRGeneratorView *-- PreviewPanel

' 2. Main Architecture Flow (Downwards)
QRGeneratorView -down-> QRGeneratorController : "events"
QRGeneratorController -down-> QRGeneratorModel : "updates"

' 3. Core Logic Connections
QRGeneratorController .down.> QRGenerator : "uses"
QRGeneratorModel o-down-> QRConfig : "holds"

' 4. Service Connections
QRGeneratorController o-down-> SettingsService
QRGeneratorController o-down-> HistoryService
QRGeneratorController .down.> FileService

' 5. Model Dependencies
QRConfig *-right-> QRType

' --- Layout Hints (Hidden lines to enforce layers) ---
' Force UI Layer above Core Layer
QRGeneratorView -[hidden]down- QRGeneratorController

' Force Core Layer above Services/Models
QRGeneratorController -[hidden]down- SettingsService
QRGeneratorController -[hidden]down- QRConfig

' Force horizontal ordering at bottom
SettingsService -[hidden]right- HistoryService
HistoryService -[hidden]right- FileService
FileService -[hidden]right- QRConfig

' --- Notes ---
note right of QRGeneratorController
    <b>Mediator</b>
    Connects UI to Logic
end note

@enduml